---
resources:
- name: newman-repo
  type: git
  source:
    uri: https://github.com/RickyCooperIBM/postman_demo.git
  
jobs:

- name: test-rest-api
  public: true
  plan:
  - get: newman-repo
  - task: test-api
    file: newman-repo/newman/newman-task.yml
    params: { "COLLECTION_URL": "https://raw.githubusercontent.com/RickyCooperIBM/postman_demo/main/newman/test_collection.json" }

  - task: commit-test-report
    config:
      platform: linux
      image_resource:
        type: registry-image
        source:
          repository: busybox
      inputs:
      - name: testReports
      run:
        path: sh
        args:
        - -cx
        - |
          ls -l .
          cat testReports/report.xml

  - task: simpletask
    config:
      platform: linux
      image_resource:
        type: docker-image
        source:
          repository: ubuntu
      run:
        path: sh
        args:
          - -exc
          - |
            cp -r newman-repo changed-repo
            git add .
            git commit -m "new test report"

      inputs:
      - name: newman-repo

  - put: newman-repo
    params: { repository: changed-repo }
